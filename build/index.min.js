/*! MovieDB-Quiz 2016-12-17 */
function IntroController(){function a(a){var c=$(a.target).attr("class").split(" ");if(c.length>1){var d=$("input."+c[1])[0].value,e=replace_query(window.location.href,c[1],d);e||(e=add_query_params(window.location.href,c[1],d)),window.location.href=e}b.unbind("click"),moveToQuizScreen()}var b=$(".option");b.on("click",a)}function QuizController(){$.get("partials/answer.html",function(a){var b=$("#content #quiz #options");$("#done").click(moveToResultsScreen);for(var c=0;c<numOfOptions;c++)b=b.append(a)}).then(function(a){var b=movie_results.length,c=movie_results[Math.floor(Math.random()*b)];charIndex=alphabetRange.a,correctAnswer=Math.floor(4*Math.random()),$("#quiz #poster").attr("src",imageHost+c.poster_path),$("#content #question").append('When was the film "'+c.title+'" released?'),$("#content .option").each(function(a,b){var d=$(b);a===correctAnswer?(d.append(String.fromCharCode(charIndex)+") "+encode_release_date(c.release_date)),d.click(function(){num_correct+=1,updateSuccessPrompt(),$("#prompt-backdrop.hidden").removeClass("hidden")})):(d.append(String.fromCharCode(charIndex)+") "+encode_release_date(c.release_date,randomize)),d.click(function(){d.addClass("chosen"),$("#wrong-choice.hidden").removeClass("hidden"),num_incorrect+=1})),charIndex+=1})})}function ResultsController(){$("#results #correct span").append(num_correct),$("#results #incorrect span").append(num_incorrect),$("#back").click(returnToIntroScreen)}function SuccessController(){$("#prompt").on("click",".option.cancel",moveToResultsScreen),$("#prompt").on("click",".option.continue",continueToNextQuiz)}function requestMovieDBData(a){var b=backendUrl+"/api/movieDB"+(a?"/"+a:"");return $.ajax({url:b,type:"GET"}).then(function(a){movie_results=a.results})}function returnToIntroScreen(){num_correct=0,num_incorrect=0,window.location.href=remove_all_queries(window.location.href)}function moveToQuizScreen(a){movie_results=requestMovieDBData(a),$("#content").empty().append('<div style="text-align: center;">Initializing data...</div>'),Promise.resolve(movie_results).then(function(){$("#content").empty().load("partials/quiz.html",QuizController)})}function moveToResultsScreen(){$("#prompt-backdrop").addClass("hidden"),$("#content").empty().load("partials/results.html",ResultsController)}function continueToNextQuiz(){$("#prompt-backdrop").addClass("hidden"),$("#content").empty().load("partials/quiz.html",QuizController)}function updateSuccessPrompt(){$("#prompt #num-answers").empty().append(num_correct)}function randomize(a){return new Date(a.getFullYear()+Math.floor(8*Math.random())-4,Math.floor(12*Math.random()))}function encode_release_date(a,b){var c=new Date(a);return b&&(c=b(c)),months[c.getMonth()]+" "+c.getFullYear().toString()}function replace_query(a,b,c){var d=find_query_info(a,b);if(null===d)return null;var e=a.substring(0,d.start-1);return e=e+"="+c,e+=a.substring(d.end)}function remove_all_queries(a){var b=a.indexOf("?");return b<0?a:a.substring(0,b)}function find_query(a,b){var c=find_query_info(a,b);return null===c?null:a.substring(c.start,c.end+1)}function find_query_info(a,b){for(var c,d,e=a.indexOf("?"),f=a.indexOf(b);f>-1&&(c=f,"="!==a.charAt(c+1));f=a.indexOf(b,f+1));return void 0===c?null:e>c?null:(d=a.indexOf("&",c),d<0&&(d=a.length-1),{start:c+b.length+1,end:d})}function add_query_params(a,b,c){"/"===a.charAt(a.length-1)&&(a=a.substring(0,a.length-1));var d=a.indexOf("?");return a=d!==-1?a.length-1===d?a.substring(0,a.length-1):a+"&"+b+"="+c:a+"?"+b+"="+c}var movie_results,backendUrl,alphabetRange={a:65,b:90},imageHost="http://image.tmdb.org/t/p/w185",months=["January","February","March","April","May","June","July","August","September","October","November","December"],numOfOptions=4,num_correct=0,num_incorrect=0,onceConfigIsLoaded=$.get("config/config.json",function(a){backendUrl=a.backendUrl});$(document).ready(function(){Promise.resolve(onceConfigIsLoaded).then(function(){var a=find_query(window.location.href,"actor");a?moveToQuizScreen("?actor="+encodeURIComponent(a)):$("#content").load("partials/intro.html",IntroController)})}),$(document).ready(function(){$.get("partials/success-prompt.html",function(a){$("html").prepend(a),SuccessController()})});